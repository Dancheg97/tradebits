package main

import (
	"crypto/x509"
	"fmt"
	"reflect"
	"sync_tree/_calc"
)

var keyBytes = []byte{48, 130, 9, 40, 2, 1, 0, 2, 130, 2, 1, 0, 190, 141, 102, 166, 13, 232, 21, 235, 16, 28, 65, 240, 28, 243, 133, 53, 138, 157, 202, 65, 176, 85, 219, 113, 164, 12, 241, 170, 49, 25, 156, 129, 183, 72, 143, 23, 210, 50, 175, 7, 24, 102, 168, 200, 211, 118, 252, 19, 12, 237, 22, 47, 149, 52, 19, 223, 53, 23, 175, 2, 166, 69, 35, 69, 17, 59, 83, 86, 52, 64, 53, 148, 242, 88, 15, 93, 103, 85, 93, 255, 140, 114, 76, 62, 123, 241, 216, 236, 9, 205, 55, 252, 141, 253, 46, 118, 32, 181, 96, 238, 87, 101, 42, 172, 15, 227, 167, 34, 85, 221, 23, 90, 53, 247, 15, 136, 22, 213, 222, 215, 53, 58, 23, 116, 189, 119, 93, 94, 235, 151, 218, 121, 124, 191, 235, 66, 230, 94, 56, 129, 162, 213, 87, 74, 107, 139, 197, 83, 116, 173, 234, 13, 91, 39, 199, 205, 13, 166, 227, 39, 83, 26, 154, 164, 176, 117, 50, 116, 202, 166, 98, 177, 83, 2, 37, 118, 216, 167, 30, 33, 154, 22, 196, 171, 8, 154, 56, 102, 12, 41, 234, 173, 97, 14, 95, 25, 171, 237, 234, 190, 231, 69, 230, 151, 254, 209, 18, 10, 164, 114, 242, 32, 166, 231, 0, 113, 52, 251, 145, 85, 76, 105, 30, 162, 83, 87, 213, 153, 159, 89, 4, 172, 6, 90, 39, 54, 54, 72, 186, 158, 163, 64, 205, 20, 25, 250, 181, 86, 161, 170, 45, 149, 34, 123, 147, 1, 85, 254, 216, 2, 89, 131, 38, 191, 96, 217, 177, 61, 249, 192, 134, 140, 181, 197, 15, 191, 153, 10, 62, 166, 17, 34, 223, 188, 149, 132, 86, 29, 142, 226, 158, 84, 84, 91, 65, 27, 137, 192, 31, 246, 58, 162, 11, 141, 251, 51, 44, 221, 189, 134, 27, 69, 225, 144, 222, 227, 214, 120, 29, 19, 77, 144, 224, 56, 147, 30, 33, 204, 8, 152, 205, 245, 161, 97, 51, 174, 35, 228, 146, 203, 44, 119, 232, 76, 240, 17, 171, 12, 41, 82, 238, 78, 57, 182, 14, 58, 90, 141, 153, 112, 66, 82, 111, 7, 118, 252, 21, 179, 242, 11, 43, 108, 167, 160, 56, 105, 228, 131, 206, 111, 186, 44, 169, 193, 59, 234, 182, 199, 214, 74, 102, 191, 32, 220, 139, 89, 63, 209, 34, 119, 15, 254, 207, 83, 29, 131, 53, 52, 156, 29, 156, 246, 99, 76, 201, 202, 224, 51, 187, 102, 235, 246, 182, 35, 189, 45, 91, 230, 99, 187, 61, 115, 210, 128, 161, 215, 122, 132, 38, 116, 180, 207, 205, 148, 128, 102, 209, 150, 100, 207, 68, 167, 187, 61, 82, 189, 159, 142, 138, 65, 197, 99, 202, 209, 114, 33, 65, 233, 37, 203, 43, 80, 30, 44, 169, 241, 2, 9, 171, 132, 135, 157, 90, 193, 154, 20, 104, 97, 194, 75, 133, 56, 154, 245, 101, 24, 143, 167, 249, 39, 126, 109, 211, 164, 155, 100, 120, 75, 218, 90, 78, 145, 2, 3, 1, 0, 1, 2, 130, 2, 0, 6, 238, 125, 221, 108, 132, 20, 200, 8, 61, 254, 232, 13, 37, 142, 162, 243, 247, 233, 115, 154, 70, 133, 69, 13, 2, 171, 135, 213, 97, 105, 32, 14, 218, 196, 217, 200, 251, 175, 2, 67, 16, 248, 242, 213, 62, 110, 205, 2, 155, 93, 67, 61, 218, 55, 30, 215, 127, 149, 14, 51, 158, 48, 58, 66, 246, 53, 129, 221, 68, 184, 174, 66, 98, 145, 172, 132, 37, 198, 213, 148, 246, 83, 111, 178, 114, 137, 193, 140, 89, 186, 191, 165, 42, 160, 150, 11, 122, 141, 156, 29, 241, 192, 43, 162, 40, 85, 220, 25, 227, 129, 5, 247, 16, 149, 176, 13, 164, 154, 6, 154, 25, 18, 225, 92, 67, 11, 82, 120, 159, 125, 131, 13, 214, 173, 104, 49, 153, 27, 213, 27, 103, 71, 85, 157, 179, 231, 233, 177, 68, 226, 78, 186, 18, 40, 98, 125, 44, 164, 246, 185, 63, 46, 128, 239, 42, 84, 59, 139, 99, 162, 19, 113, 65, 146, 187, 80, 6, 68, 66, 84, 168, 159, 94, 217, 97, 66, 203, 243, 133, 82, 212, 27, 195, 186, 17, 228, 255, 50, 154, 223, 46, 219, 196, 139, 176, 111, 71, 147, 211, 218, 154, 245, 119, 81, 188, 204, 128, 154, 56, 208, 30, 194, 206, 132, 217, 157, 27, 137, 128, 99, 123, 30, 128, 9, 13, 31, 204, 101, 125, 127, 210, 203, 162, 255, 142, 239, 41, 199, 151, 185, 48, 195, 160, 91, 40, 145, 32, 233, 209, 207, 245, 102, 24, 124, 191, 159, 85, 42, 209, 7, 103, 236, 120, 255, 95, 107, 214, 216, 23, 47, 108, 92, 38, 24, 210, 15, 181, 4, 32, 65, 68, 31, 13, 97, 121, 226, 24, 139, 28, 182, 134, 198, 84, 65, 60, 228, 97, 94, 182, 140, 104, 43, 183, 252, 173, 142, 29, 132, 17, 208, 53, 51, 155, 182, 200, 248, 241, 236, 29, 42, 60, 144, 114, 124, 189, 228, 35, 167, 250, 229, 218, 104, 162, 164, 222, 111, 157, 128, 153, 10, 212, 243, 177, 219, 236, 85, 8, 226, 239, 80, 65, 86, 13, 212, 100, 246, 195, 93, 251, 35, 80, 240, 132, 233, 249, 204, 221, 118, 155, 29, 157, 126, 196, 104, 177, 222, 242, 109, 229, 19, 158, 84, 90, 126, 123, 234, 229, 132, 58, 246, 202, 193, 165, 129, 24, 180, 165, 240, 199, 249, 236, 31, 186, 218, 133, 5, 217, 187, 97, 207, 102, 77, 143, 247, 142, 202, 97, 73, 212, 118, 150, 99, 42, 202, 121, 233, 198, 244, 164, 49, 79, 60, 1, 134, 226, 20, 126, 222, 103, 28, 52, 109, 26, 130, 152, 77, 107, 237, 195, 119, 3, 190, 69, 142, 72, 10, 157, 40, 199, 160, 12, 138, 179, 113, 182, 104, 6, 166, 10, 51, 216, 237, 85, 144, 202, 134, 185, 75, 245, 214, 30, 83, 113, 248, 33, 172, 1, 3, 221, 192, 170, 255, 233, 166, 44, 35, 21, 226, 65, 244, 1, 2, 130, 1, 1, 0, 199, 75, 162, 89, 129, 26, 126, 28, 0, 113, 79, 207, 119, 202, 0, 30, 163, 117, 58, 31, 41, 19, 86, 130, 228, 51, 219, 92, 17, 67, 167, 119, 6, 34, 61, 48, 45, 47, 212, 12, 74, 16, 101, 216, 3, 154, 81, 228, 115, 130, 3, 20, 55, 84, 63, 167, 230, 62, 62, 134, 173, 34, 94, 223, 58, 30, 36, 30, 116, 187, 29, 220, 125, 99, 213, 111, 151, 242, 21, 225, 200, 49, 141, 218, 42, 224, 168, 31, 253, 100, 182, 126, 126, 162, 202, 97, 77, 21, 6, 255, 226, 208, 60, 89, 184, 169, 183, 177, 199, 1, 136, 64, 251, 35, 13, 196, 98, 205, 155, 165, 129, 127, 48, 202, 63, 162, 60, 62, 254, 18, 75, 234, 48, 45, 21, 102, 209, 142, 69, 157, 126, 167, 209, 133, 132, 3, 245, 26, 228, 189, 233, 53, 104, 253, 71, 200, 51, 153, 66, 101, 173, 211, 131, 48, 111, 111, 96, 129, 110, 228, 54, 203, 61, 10, 14, 227, 9, 28, 60, 121, 235, 79, 18, 37, 129, 50, 27, 139, 207, 65, 110, 183, 131, 91, 46, 82, 181, 199, 12, 86, 147, 108, 39, 180, 110, 14, 207, 255, 184, 231, 152, 69, 27, 109, 137, 108, 35, 44, 115, 212, 82, 4, 134, 236, 68, 86, 128, 244, 255, 82, 20, 5, 187, 172, 204, 252, 184, 87, 44, 1, 187, 73, 41, 180, 226, 227, 187, 197, 251, 202, 45, 237, 197, 161, 76, 73, 2, 130, 1, 1, 0, 244, 196, 238, 236, 133, 42, 40, 1, 145, 92, 198, 73, 86, 88, 56, 39, 54, 75, 32, 81, 234, 255, 19, 77, 82, 90, 4, 28, 249, 237, 75, 245, 39, 248, 127, 152, 243, 118, 247, 114, 132, 38, 147, 193, 66, 174, 184, 122, 84, 6, 119, 74, 13, 19, 116, 170, 218, 169, 89, 83, 105, 111, 71, 185, 161, 76, 134, 189, 241, 54, 95, 139, 89, 122, 187, 88, 55, 236, 215, 80, 143, 19, 166, 153, 157, 94, 183, 10, 218, 129, 133, 79, 202, 161, 43, 3, 107, 9, 223, 231, 229, 35, 152, 87, 123, 216, 37, 98, 79, 118, 198, 248, 119, 237, 33, 131, 198, 197, 117, 99, 111, 251, 167, 8, 173, 40, 226, 34, 241, 146, 223, 60, 124, 18, 216, 181, 243, 76, 63, 227, 251, 108, 106, 169, 235, 148, 147, 191, 168, 164, 9, 34, 178, 125, 174, 21, 24, 157, 207, 145, 212, 3, 79, 6, 240, 125, 90, 29, 117, 239, 152, 54, 48, 98, 26, 128, 70, 176, 63, 15, 201, 135, 184, 13, 70, 37, 183, 27, 71, 244, 14, 148, 176, 180, 60, 156, 46, 207, 166, 80, 181, 198, 31, 156, 74, 135, 244, 170, 147, 175, 65, 254, 188, 137, 91, 0, 8, 191, 78, 211, 123, 19, 24, 121, 254, 55, 66, 196, 55, 25, 37, 143, 72, 0, 109, 232, 99, 114, 6, 223, 103, 215, 23, 189, 183, 206, 193, 118, 225, 252, 242, 134, 189, 249, 160, 9, 2, 130, 1, 0, 125, 60, 99, 29, 249, 138, 11, 91, 79, 79, 229, 70, 75, 81, 77, 183, 243, 33, 180, 79, 102, 129, 119, 104, 179, 60, 127, 9, 32, 244, 49, 165, 18, 222, 171, 50, 190, 2, 131, 46, 225, 207, 226, 31, 215, 75, 191, 80, 94, 225, 129, 75, 207, 229, 10, 71, 88, 225, 30, 107, 133, 26, 199, 33, 97, 165, 21, 47, 106, 77, 55, 91, 154, 20, 5, 72, 165, 228, 3, 170, 41, 34, 50, 176, 185, 39, 9, 159, 104, 157, 68, 44, 195, 41, 75, 33, 207, 205, 121, 227, 140, 197, 44, 87, 121, 58, 117, 107, 170, 209, 164, 172, 168, 228, 3, 63, 184, 146, 217, 207, 44, 76, 31, 253, 199, 245, 12, 4, 205, 165, 243, 188, 139, 95, 153, 70, 78, 67, 40, 45, 235, 44, 75, 246, 169, 217, 206, 201, 130, 154, 112, 149, 22, 143, 170, 238, 252, 181, 191, 74, 163, 235, 249, 81, 147, 133, 26, 208, 219, 61, 95, 205, 97, 99, 19, 173, 201, 200, 203, 156, 21, 169, 79, 142, 239, 219, 236, 1, 116, 80, 250, 225, 41, 19, 64, 77, 203, 90, 244, 190, 230, 207, 29, 56, 61, 188, 227, 42, 32, 40, 176, 192, 36, 151, 53, 183, 21, 119, 86, 166, 66, 144, 3, 181, 46, 208, 105, 35, 11, 218, 169, 40, 93, 34, 30, 130, 100, 216, 170, 151, 191, 248, 30, 212, 67, 139, 182, 48, 152, 164, 25, 46, 132, 117, 114, 185, 2, 130, 1, 1, 0, 129, 110, 45, 165, 54, 89, 111, 100, 60, 216, 161, 37, 160, 153, 239, 191, 148, 111, 47, 125, 1, 213, 182, 0, 58, 30, 205, 116, 1, 24, 225, 4, 151, 9, 73, 119, 184, 174, 92, 244, 218, 58, 136, 1, 54, 224, 171, 62, 76, 118, 74, 216, 6, 136, 22, 54, 78, 128, 36, 114, 254, 26, 209, 3, 176, 238, 133, 133, 165, 42, 138, 101, 102, 128, 134, 214, 132, 100, 34, 11, 64, 77, 52, 216, 160, 37, 184, 134, 237, 186, 117, 163, 22, 212, 24, 169, 171, 13, 66, 176, 30, 51, 175, 87, 251, 109, 245, 126, 193, 228, 94, 28, 127, 86, 14, 85, 223, 99, 4, 202, 251, 41, 72, 79, 71, 57, 138, 50, 206, 41, 75, 16, 113, 207, 137, 118, 213, 91, 169, 161, 69, 143, 51, 235, 252, 93, 201, 175, 28, 94, 249, 81, 182, 174, 204, 193, 237, 13, 109, 248, 127, 242, 235, 244, 16, 113, 72, 152, 177, 135, 107, 166, 163, 249, 12, 104, 110, 120, 190, 47, 251, 242, 95, 121, 237, 112, 254, 29, 87, 244, 15, 77, 195, 14, 219, 201, 254, 218, 224, 232, 102, 230, 136, 74, 158, 2, 188, 119, 2, 183, 55, 31, 155, 212, 202, 32, 255, 127, 34, 16, 164, 81, 25, 173, 80, 167, 42, 16, 21, 206, 159, 84, 223, 207, 18, 79, 67, 94, 197, 145, 151, 24, 95, 62, 124, 22, 193, 168, 186, 161, 134, 33, 136, 13, 154, 249, 2, 130, 1, 0, 127, 63, 173, 4, 79, 227, 149, 131, 6, 125, 122, 126, 248, 84, 196, 149, 200, 14, 94, 15, 90, 197, 115, 133, 60, 148, 214, 160, 171, 226, 92, 69, 45, 177, 14, 168, 86, 37, 73, 27, 4, 42, 195, 174, 23, 135, 54, 38, 191, 163, 43, 130, 18, 124, 202, 193, 87, 126, 88, 216, 103, 225, 241, 60, 59, 111, 173, 178, 246, 67, 119, 130, 46, 246, 23, 131, 49, 48, 52, 188, 12, 123, 28, 22, 16, 149, 181, 24, 111, 150, 211, 27, 46, 71, 9, 207, 184, 255, 35, 92, 32, 201, 156, 91, 138, 131, 66, 159, 211, 147, 249, 228, 84, 39, 208, 38, 185, 21, 132, 37, 204, 147, 249, 29, 8, 160, 165, 7, 56, 255, 156, 10, 103, 100, 248, 62, 39, 70, 193, 112, 161, 213, 14, 224, 164, 215, 36, 183, 243, 21, 213, 85, 91, 242, 252, 27, 9, 24, 117, 26, 174, 159, 25, 196, 157, 56, 62, 70, 12, 74, 165, 250, 80, 220, 117, 30, 83, 53, 0, 104, 79, 125, 223, 214, 14, 64, 74, 39, 205, 91, 250, 192, 137, 216, 185, 95, 153, 41, 16, 245, 13, 241, 126, 39, 54, 145, 87, 113, 140, 127, 199, 84, 233, 83, 132, 0, 149, 157, 130, 97, 50, 5, 90, 28, 201, 50, 162, 157, 128, 187, 246, 113, 98, 26, 218, 87, 207, 139, 245, 10, 170, 55, 232, 114, 79, 229, 161, 151, 162, 75, 81, 235, 1, 77, 112, 179}

func hashTest() {
	hash := _calc.Hash([]byte{0})
	expected := []byte{82, 183, 9, 232, 198, 142, 69, 166, 187, 232, 192, 96, 68, 75, 73, 151, 112, 183, 61, 164, 253, 193, 184, 5, 181, 233, 156, 208, 175, 166, 26, 164, 209, 27, 80, 16, 145, 0, 78, 104, 11, 151, 150, 131, 100, 121, 160, 43, 34, 196, 98, 251, 92, 80, 223, 142, 20, 163, 21, 232, 171, 85, 72, 39}
	if reflect.DeepEqual(hash, expected) {
		fmt.Println("\033[32m[TEST] (CALC) {Hash} - passed\033[0m")
		return
	}
	fmt.Println("\033[31m[TEST] (CALC) {Hash} - test failed\033[0m")
}

func signTest() {
	mes := []byte{1, 2, 3}
	sign, _ := _calc.Sign([][]byte{mes, mes}, keyBytes)
	if len(sign) == 512 {
		fmt.Println("\033[32m[TEST] (CALC) {Sign} - passed\033[0m")
		return
	}
	fmt.Println("\033[31m[TEST] (CALC) {Sign} - test failed\033[0m")
}

func verifyTest() {
	mes := []byte{1, 2, 3}
	sign, _ := _calc.Sign([][]byte{mes, mes}, keyBytes)
	priv, _ := x509.ParsePKCS1PrivateKey(keyBytes)
	pubBytes := x509.MarshalPKCS1PublicKey(&priv.PublicKey)
	verified := _calc.Verify(
		[][]byte{mes, mes},
		pubBytes,
		sign,
	)
	if verified == nil {
		fmt.Println("\033[32m[TEST] (CALC) {Verify} - passed\033[0m")
		return
	}
	fmt.Println("\033[31m[TEST] (CALC) {Verify} - test failed\033[0m")
}

func main() {
	hashTest()
	signTest()
	verifyTest()
}

//fmt.Println(strings.Trim(strings.Join(strings.Fields(fmt.Sprint(sign)), ", "), "[]"))
